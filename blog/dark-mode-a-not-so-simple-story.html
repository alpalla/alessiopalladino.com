<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" as="image" href="/images/themeflicker.gif"/><link rel="preload" as="image" href="/images/matchmediainaction.gif"/><link rel="preload" as="image" href="/images/lighttheme.PNG"/><link rel="preload" as="image" href="/images/themeupdatebug.PNG"/><link rel="preload" as="image" href="/images/darktheme.PNG"/><link rel="stylesheet" href="/_next/static/css/0beb6f02e3b80d7a.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-da7bd31efd1877ed.js"/><script src="/_next/static/chunks/4bd1b696-5e5d36ddbce829e9.js" async=""></script><script src="/_next/static/chunks/517-c3e07f939f7116c3.js" async=""></script><script src="/_next/static/chunks/main-app-c46a2d7bbebcba78.js" async=""></script><script src="/_next/static/chunks/839-637add48329eea7f.js" async=""></script><script src="/_next/static/chunks/app/blog/dark-mode-a-not-so-simple-story/page-b9d4e4c93075cca1.js" async=""></script><script src="/_next/static/chunks/app/layout-0a6be1a83533b9a5.js" async=""></script><meta name="next-size-adjust"/><meta id="meta-theme-color" name="theme-color"/><title>Dark Mode, a Not so Simple Story ‚Ä¢ Alessio Palladino</title><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="32x32"/><link id="dark-css" rel="stylesheet" href="/dark.css"/><link id="light-css" rel="stylesheet" href="/light.css"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__className_d65c78"><script src="/theme.js"></script><div class="flex justify-center px-4"><div class="flex flex-col h-dvh max-w-screen-lg w-full"><div class="navbar"><div class="flex-1"><a class="btn btn-ghost no-animation text-xl" href="/">Home</a></div><div class="flex-none pr-2"><a class="btn btn-ghost no-animation text-xl" href="/about">About</a><a class="btn btn-ghost no-animation text-xl" href="/blog">Blog</a></div><button class="dark-mode-btn btn-ghost"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-moon moon-icon"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg></button></div><div class="flex justify-center py-8"><div class="max-w-screen-md w-full"><div class="pb-4"><a class="flex items-center justify-center size-[48px] rounded-full btn-ghost" href="/blog"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg></a></div><article class="prose prose-lg">
<h1>Dark Mode, a Not so Simple Story</h1>
<div><small><i>Published November 11th, 2024</i></small></div>
<div><small><i>Updated November 16th, 2024</i></small></div>
<h2>Introduction</h2>
<p>Dark mode may seem like an easy feature to implement. From the point of view of a user, you click a button and things change color.
However, appearances can be deceiving. If you stop and think of all the requirements for dark mode in detail, you&#x27;ll soon realize that things are not so simple.
There&#x27;s also an interesting disconnect between implementing this feature in vanilla JS, and implementing it using a modern framework.
In the latter, you&#x27;ll run into cases where what you need to do is either unsupported or highly discouraged.
In this article, I&#x27;ll go into how I implemented dark mode for this website.
I think you&#x27;ll be surprised by the myriad of concepts involved in implementing such a seemingly simple feature, I know I was!
There&#x27;s definitely a lot to be learned from doing something like this yourself!</p>
<h2>The Requirements</h2>
<p>Let me begin by defining the requirements I had in mind when I wanted to implement dark mode:</p>
<ul>
<li>Clicking the dark mode button changes the website color theme between ‚Äúlight‚Äù and ‚Äúdark‚Äù.</li>
<li>When the dark mode button is clicked, the applied theme is persisted. This way if the user reloads the page,
the chosen theme remains active (the user does not have to click the button again).</li>
<li>If the user reloads the page there should not be any kind of flickering between themes.</li>
<li>If the user has not interacted with the dark mode button, the user&#x27;s system theme is used as default.
And if the system theme changes, the website theme changes accordingly.
Once the user interacts with the dark mode button, the system theme is not taken into account anymore.</li>
</ul>
<h2>My Tech Stack</h2>
<p>Dark mode can be implemented in vanilla JS. However, the interesting bit is making it work the same way using a modern framework.
I implemented this website using <a href="https://nextjs.org/">Next.js</a> and its <a href="https://nextjs.org/docs/app">App Router</a>.
I use <a href="https://tailwindcss.com/">Tailwind CSS</a> and <a href="https://daisyui.com/">Daisy UI</a> to handle styling my website.
In particular, Daisy UI lets me easily apply default themes to the entire website.</p>
<h2>Implementing Dark Mode</h2>
<h3>1. Handling Themes With Daisy UI</h3>
<p>üí°<strong>Key concept:</strong> using a <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/data-*"><code>data-*</code></a>
attribute to set a theme for the website.</p>
<p>If you&#x27;re curious about following my implementation and you&#x27;re using another library to handle your design system, Daisy UI isn&#x27;t necessary.
However, it does provide preconfigured themes and makes it really easy to apply any one of them to the entire website.
In your tailwind config file you just need to specify:</p>
<pre class="break-words code-block text-wrap"><code class="language-ts hljs"><span class="hljs-attr">daisyui</span>: {
  <span class="hljs-attr">themes</span>: [<span class="hljs-string">&quot;light&quot;</span>, <span class="hljs-string">&quot;dark&quot;</span>],
},
</code></pre>
<p>After that all you need to do is set the <code>data-theme</code> attribute on an element high up in the DOM with either the ‚Äúlight‚Äù or ‚Äúdark‚Äù value.
I use ‚Äúlight‚Äù as the default fallback:</p>
<pre class="break-words code-block text-wrap"><code class="language-html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">data-theme</span>=<span class="hljs-string">&quot;light&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p>Do this in the Next.js <a href="https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates#root-layout-required">Root Layout</a>
to modify the initial HTML returned from the server for every page.</p>
<p>And you&#x27;re done! This is all you need to apply a theme to your website. The real trick will be correctly switching between themes.</p>
<p>Note: whether you&#x27;re using Daisy UI or not, you should have a way to switch between themes by simply specifying a value for a <code>data-*</code> attribute.</p>
<h3>2. Switching Between Themes With a Button</h3>
<p>üí°<strong>Key concept:</strong> React Server Components vs. React Client Components.</p>
<p>Now that we have a way to easily apply different themes to our website, let&#x27;s fulfill the first requirement I listed before: adding a button that allows the user to swap between themes.</p>
<p>As I mentioned earlier, when the user clicks on the button we want to change the <code>data-*</code> theme attribute on the <code>&lt;html&gt;</code> element. You might think of implementing a Component like this one:</p>
<pre class="break-words code-block text-wrap"><code class="language-tsx hljs"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Moon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lucide-react&quot;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">DarkModeButton</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">onClick</span> = (<span class="hljs-params"></span>) =&gt; {
    <span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>)

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(
      <span class="hljs-string">&quot;data-theme&quot;</span>,
      theme === <span class="hljs-string">&quot;light&quot;</span> ? <span class="hljs-string">&quot;dark&quot;</span> : <span class="hljs-string">&quot;light&quot;</span>
    )
  }
  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Moon</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span> /&gt;</span></span>
}
</code></pre>
<p>Note: I&#x27;m currently using <code>lucide-react</code> for my icons. If you want the icon itself to
change color according to the current theme, you can specify a CSS class for the icon and then
set different colors for it according to the theme in your tailwind config file.</p>
<p>However, if you&#x27;re using the App Router you&#x27;ll run into a runtime error right away:</p>
<pre class="break-words code-block text-wrap"><code class="language-text hljs">Error: Event handlers cannot be passed to Client Component props.
  &lt;button onClick={function onClick} children=...&gt;
                  ^^^^^^^^^^^^^^^^^^
If you need interactivity, consider converting part of this to a Client Component.
</code></pre>
<p>When using the App Router every Component is a React Server Component (RSC) by default, unless specified otherwise with the <code>&#x27;use client&#x27;</code> directive.
I won&#x27;t explain React Server Components in detail in this article,
but Josh Comeau wrote a great article, <a href="https://www.joshwcomeau.com/react/server-components/">Making Sense of React Server Components</a>,
which explains them very clearly. To make a long story short, React Server Components do not allow for interactivity.
Though they are new and may initially frustrate you with errors like the one above,
React Server Components are actually simpler versions of ‚Äúregular‚Äù Components.
You can&#x27;t use any <code>useState</code> or <code>useEffect</code> hooks in them. And seeing as they only render <strong>once</strong>,
they free you from some of the <a href="https://react.dev/reference/rules">Rules of React</a> since you&#x27;ll never run into any re-render related issues with them.</p>
<p>In our case we need interactivity and therefore can&#x27;t use a React Server Component for our button. We need ‚Äúregular‚Äù React Components, now known as Client Components.
Simply adding the <code>&#x27;use client&#x27;</code> directive at the top of the file above fixes the issue for us.</p>
<p>Now we can change the theme with a click of a button, but if you reload the page you&#x27;ll see that the changes to the theme are lost‚Ä¶</p>
<h3>3. Persisting the Theme Using Local Storage</h3>
<p>üí°<strong>Key concept:</strong> local storage.</p>
<p>In order to avoid losing changes to the theme, we must persist the theme in some way.
Using the <code>window</code> <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage</a> property makes this a breeze.
When the user clicks on the button, we store the name of the applied theme. And when the page loads,
we read from local storage and set the theme accordingly. Though as you&#x27;ll see we&#x27;ll quickly run into an important issue later on.</p>
<p>Let&#x27;s create a hook called <code>useThemeHandler()</code> to encapsulate all of our
theme switching logic, which we can then call in our <code>DarkModeButton</code> Component.
The hook will:</p>
<ol>
<li>Call <code>useEffect()</code> to handle reading from local storage and
apply the current theme on page load.</li>
<li>Return a callback that handles switching and storing the theme,
which we can pass to the <code>onClick</code> attribute of our <code>&lt;button&gt;</code>.</li>
</ol>
<pre class="break-words code-block text-wrap"><code class="language-tsx hljs"><span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useThemeHandler</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, theme ?? <span class="hljs-string">&quot;light&quot;</span>)
  }, [])

  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>)

    <span class="hljs-keyword">const</span> newTheme = theme === <span class="hljs-string">&quot;light&quot;</span> ? <span class="hljs-string">&quot;dark&quot;</span> : <span class="hljs-string">&quot;light&quot;</span>

    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, newTheme)

    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;theme&quot;</span>, newTheme)
  }
}
</code></pre>
<p>Then our <code>DarkModeButton</code> will just be:</p>
<pre class="break-words code-block text-wrap"><code class="language-tsx hljs"><span class="hljs-string">&quot;use client&quot;</span>

<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Moon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;lucide-react&quot;</span>
<span class="hljs-keyword">import</span> { useThemeHandler } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./useThemeHandler&quot;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">DarkModeButton</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">const</span> handleTheme = <span class="hljs-title function_">useThemeHandler</span>()

  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Moon</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleTheme}</span> /&gt;</span></span>
}
</code></pre>
<p>The theme is now persisted if we reload the page.
However, when we reload it we can clearly see that the theme flickers... üò±</p>
<div class="flex justify-center"><p><img src="/images/themeflicker.gif" alt="Theme flicker" title="Theme flicker"/></p></div>
<h3>4. Preventing Theme Flicker</h3>
<p>üí°<strong>Key concept:</strong> the critical rendering path.</p>
<p>Now onto my favorite part.
Preventing the theme from flickering will force us to implement a solution
that goes against the recommendations of an opinionated framework like Next.js.
I find this topic particularly stimulating because while a framework can be opinionated for good reasons,
it&#x27;s always interesting to see cases where we need to exit the framework and venture into what seems like no man&#x27;s land.</p>
<p>In our case, to prevent the theme from flickering,
we&#x27;ll need to block the rendering of the page until we&#x27;ve determined what theme to use.
More specifically, during the first of five steps in the
<a href="https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path">critical rendering path</a>,
the browser processes the HTML and builds the DOM.
According to the MDN web docs
<a href="https://developer.mozilla.org/en-US/docs/Web/Performance/How_browsers_work#parsing">Populating the page: how browsers work</a>:</p>
<blockquote>
<p>When the parser finds non-blocking resources, such as an image, the browser will request those resources and continue parsing. Parsing can continue when a CSS file is encountered, but <code>&lt;script&gt;</code> elements ‚Äî particularly those without an async or defer attribute ‚Äî block rendering, and pause the parsing of HTML. Though the browser&#x27;s preload scanner hastens this process, excessive scripts can still be a significant bottleneck.</p>
</blockquote>
<p>You can start to see why Next.js discourages what we&#x27;re about to do‚Ä¶
To block rendering until we&#x27;ve established what theme to use, we&#x27;ll write a script to determine the theme to use and insert it at the very top of the <code>&lt;body&gt;</code> element in our Root Layout.
This is not possible using the Next.js <code>&lt;Script&gt;</code> Component. We&#x27;ll also have to disable the <code>@next/next/no-sync-scripts</code> ESLint rule:</p>
<pre class="break-words code-block text-wrap"><code class="language-html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">className</span>=<span class="hljs-string">&quot;{inter.className}&quot;</span>&gt;</span>
  {/* eslint-disable-next-line @next/next/no-sync-scripts */}
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/theme.js&quot;</span> /&gt;</span><span class="language-handlebars"><span class="language-xml">
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</span></span></code></pre>
<p>The script itself is very simple and does the same thing we were doing in the <code>useThemeHandler</code> hook&#x27;s <code>useEffect</code>:</p>
<pre class="break-words code-block text-wrap"><code class="language-js hljs">;(<span class="hljs-keyword">function</span> <span class="hljs-title function_">initTheme</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> theme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, theme ?? <span class="hljs-string">&quot;light&quot;</span>)
})()
</code></pre>
<p>We&#x27;re wrapping the script in an <a href="https://developer.mozilla.org/en-US/docs/Glossary/IIFE">IIFE</a> in order for it to execute immediately.
And now, no more flickering! ü•≥</p>
<p>Note: with the current implementation, if you open your DevTools you&#x27;ll see an interesting error.</p>
<pre class="break-words code-block text-wrap"><code class="language-text hljs">Warning: Prop `data-theme` did not match. Server: &quot;dark&quot; Client: &quot;light&quot;
at html
at RootLayout (Server)
at RedirectErrorBoundary (
</code></pre>
<p>Next.js pre-renders our application&#x27;s React tree on the server so that our browser may receive pre-rendered HTML.
As is stated in the documentation for the
<a href="https://nextjs.org/docs/messages/react-hydration-error">Text content does not match server-rendered HTML</a> error:</p>
<blockquote>
<p>Hydration is when React converts the pre-rendered HTML from the server into a fully interactive application by attaching event handlers.</p>
</blockquote>
<p>When there is a difference between the React tree pre-rendered on the server and the React tree following Hydration, Next.js shows us this error.</p>
<p>In our case this makes sense because in our Root Layout, which defines initial HTML returned from the server for every page,
we specified ‚Äúlight‚Äù as the default value for the html elements&#x27;s <code>data-theme</code> attribute. But when the user chooses dark mode and our render-blocking script runs,
that attribute changes, causing a difference in the React trees.</p>
<p>Fortunately we can easily silence this error by adding the <code>suppressHydrationWarning</code> attribute to our html element.</p>
<h3>5. Respecting the User&#x27;s System Theme Preference</h3>
<p>üí°<strong>Key concept:</strong> the Window interface&#x27;s <code>matchMedia()</code> method.</p>
<p>We basically completed dark mode, but one improvement could be to set the initial theme according to the user&#x27;s system preference.
So in case the user hasn&#x27;t interacted with the dark mode button, therefore not communicated a preference between the light or dark themes;
we can begin by setting the theme to match the user&#x27;s system theme instead of always defaulting to ‚Äúlight‚Äù.</p>
<p>We&#x27;ll use the <code>prefers-color-scheme: dark</code> media query to detect if the user requested light or dark color themes.</p>
<p>Thankfully this is easy to do in JavaScript using the Window interface&#x27;s <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia">matchMedia()</a> method.
In our render-blocking script, if there is no stored theme, we can set it to dark mode if the user requested it:</p>
<pre class="break-words code-block text-wrap"><code class="language-js hljs"><span class="hljs-keyword">const</span> prefersDarkColorScheme = <span class="hljs-title function_">matchMedia</span>(
  <span class="hljs-string">&quot;(prefers-color-scheme: dark)&quot;</span>
).<span class="hljs-property">matches</span>

<span class="hljs-keyword">if</span> (prefersDarkColorScheme) {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, <span class="hljs-string">&quot;dark&quot;</span>)
}
</code></pre>
<p>For additional polish, we can add an event listener to the media query list returned by the <code>matchMedia()</code> method:</p>
<pre class="break-words code-block text-wrap"><code class="language-js hljs"><span class="hljs-variable language_">window</span>
  .<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">`(prefers-color-scheme: dark)`</span>)
  .<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;change&quot;</span>, <span class="hljs-function">(<span class="hljs-params">{ matches }</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)) {
      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-title function_">applyTheme</span>(matches ? <span class="hljs-string">&quot;dark&quot;</span> : <span class="hljs-string">&quot;light&quot;</span>)
  })
</code></pre>
<p>This way if the user still hasn&#x27;t interacted with the dark mode button but changes the system theme while our website is open,
the website&#x27;s color scheme will change when the system theme also changes.</p>
<div class="flex justify-center"><p><img src="/images/matchmediainaction.gif" alt="Match media in action" title="Match media in
action"/></p></div>
<p>My final render-blocking script looks something like this:</p>
<pre class="break-words code-block text-wrap"><code class="language-js hljs">;(<span class="hljs-keyword">function</span> <span class="hljs-title function_">initTheme</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">const</span> storedTheme = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">applyTheme</span> = (<span class="hljs-params">theme</span>) =&gt; {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, theme)
  }

  <span class="hljs-keyword">if</span> (storedTheme) {
    <span class="hljs-title function_">applyTheme</span>(storedTheme)

    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-variable language_">window</span>
    .<span class="hljs-title function_">matchMedia</span>(<span class="hljs-string">`(prefers-color-scheme: dark)`</span>)
    .<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;change&quot;</span>, <span class="hljs-function">(<span class="hljs-params">{ matches }</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)) {
        <span class="hljs-keyword">return</span>
      }

      <span class="hljs-title function_">applyTheme</span>(matches ? <span class="hljs-string">&quot;dark&quot;</span> : <span class="hljs-string">&quot;light&quot;</span>)
    })

  <span class="hljs-keyword">const</span> prefersDarkColorScheme = <span class="hljs-title function_">matchMedia</span>(
    <span class="hljs-string">&quot;(prefers-color-scheme: dark)&quot;</span>
  ).<span class="hljs-property">matches</span>

  prefersDarkColorScheme &amp;&amp; <span class="hljs-title function_">applyTheme</span>(<span class="hljs-string">&quot;dark&quot;</span>)
})()
</code></pre>
<p>While my <code>useThemeHandler()</code> looks like this:</p>
<pre class="break-words code-block text-wrap"><code class="language-ts hljs"><span class="hljs-keyword">import</span> { useCallback } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react&quot;</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Theme</span> = <span class="hljs-string">&quot;light&quot;</span> | <span class="hljs-string">&quot;dark&quot;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">applyTheme</span> = (<span class="hljs-params"><span class="hljs-attr">theme</span>: <span class="hljs-title class_">Theme</span></span>) =&gt; {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;data-theme&quot;</span>, theme)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">getStoredTheme</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;theme&quot;</span>)

<span class="hljs-keyword">const</span> <span class="hljs-title function_">storeTheme</span> = (<span class="hljs-params"><span class="hljs-attr">theme</span>: <span class="hljs-title class_">Theme</span></span>) =&gt; <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">&quot;theme&quot;</span>, theme)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useThemeHandler</span> = (<span class="hljs-params"></span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useCallback</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> storedTheme = <span class="hljs-title function_">getStoredTheme</span>()

    <span class="hljs-keyword">if</span> (storedTheme) {
      <span class="hljs-keyword">const</span> newTheme = storedTheme === <span class="hljs-string">&quot;dark&quot;</span> ? <span class="hljs-string">&quot;light&quot;</span> : <span class="hljs-string">&quot;dark&quot;</span>

      <span class="hljs-title function_">applyTheme</span>(newTheme)

      <span class="hljs-title function_">storeTheme</span>(newTheme)

      <span class="hljs-keyword">return</span>
    }

    <span class="hljs-keyword">const</span> prefersDarkColorScheme = <span class="hljs-title function_">matchMedia</span>(
      <span class="hljs-string">&quot;(prefers-color-scheme: dark)&quot;</span>
    ).<span class="hljs-property">matches</span>

    <span class="hljs-keyword">const</span> newTheme = prefersDarkColorScheme ? <span class="hljs-string">&quot;light&quot;</span> : <span class="hljs-string">&quot;dark&quot;</span>

    <span class="hljs-title function_">applyTheme</span>(newTheme)

    <span class="hljs-title function_">storeTheme</span>(newTheme)
  }, [])
}
</code></pre>
<p>Note that the last lines of the hook handle the case where the user clicks on the button but the new theme to apply may not be the default light color scheme
since we are now reacting to the <code>prefers-color-scheme: dark</code> in our render-blocking script.</p>
<p>And that&#x27;s it, we now have a robust and polished dark mode feature on our website! üéâ</p>
<p>To keep things relatively simple, I left out some logic from the above script and hook.
But below I&#x27;ll discuss how you can handle that yourself if you feel so inclined. üôÇ</p>
<h2>6. Bonus Points</h2>
<p>Without going too much into detail I wanted to mention two additional cases
you might want to be aware of if you&#x27;re implementing dark mode yourself.</p>
<h3>Supporting Syntax Highlighting</h3>
<p>In case you haven&#x27;t noticed yet, when you switch the theme on my website
the syntax highlighting for the code blocks changes.
This is simple enough to do, you just need to include the stylesheets for each theme
in your Root Layout.</p>
<p>What you may not know is that you can disable any one of the stylesheets programmatically
with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLLinkElement/disabled">HTMLLinkElement: disabled property</a>:</p>
<blockquote>
<p>Setting the disabled property using JavaScript causes the stylesheet to be removed from the document&#x27;s Document.styleSheets list.</p>
</blockquote>
<h3>Setting the User Agent UI Color Scheme</h3>
<p>This is an edge case that I noticed is not even handled in
<a href="https://github.com/saadeghi/theme-change">theme-change</a>
, which Daisy UI recommends in its documentation for handling switching themes.</p>
<p>Some browsers allow theme colors to be set on the user interface surrounding the page.
When switching themes programmatically like we are, this theme color is not updated the same way.
What results is a visible bug where our website displays the correctly selected theme while the
surrounding UI is still displaying the previous color scheme. Refreshing the page correctly updates the
UI, but that&#x27;s not good enough for us!</p>
<p>Below you can see an example of what I mean. In the first screenshot you see the correct light color scheme.
However when I click on the dark mode button the website theme correctly changes but the
surrounding browser UI (visibly the status and address bar areas) is still using
the &quot;light&quot; color scheme. In the last screenshot I reloaded the page and the dark theme is
correctly displayed.</p>
<div class="flex gap-2"><img width="33%" src="/images/lighttheme.PNG" alt="Homepage with light theme"/><img width="33%" src="/images/themeupdatebug.PNG" alt="Homepage with bug where both light and dark themes are visible"/><img width="33%" src="/images/darktheme.PNG" alt="Homepage with dark theme"/></div>
<p>You can fix this by specifying a <code>&lt;meta&gt;</code> element with
<code>name=&quot;theme-color&quot;</code> and some <code>id</code>. Then programmatically set the <code>content</code> attribute with
the desired color when switching themes. As stated in the documentation,
<a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta/name/theme-color">theme-color</a>:</p>
<blockquote>
<p>indicates a suggested color that user agents should use to customize the display of the page or of the surrounding user interface.</p>
</blockquote>
<p>In my Root Layout I included this <code>&lt;meta&gt;</code> element in the document <code>&lt;head&gt;</code>:</p>
<pre class="break-words code-block text-wrap"><code class="language-html hljs"><span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;meta-theme-color&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;theme-color&quot;</span> /&gt;</span>
</code></pre>
<p>Then in the <code>useThemeHandler()</code> hook, when applying a <code>theme</code>, I do this:</p>
<pre class="break-words code-block text-wrap"><code class="language-ts hljs"><span class="hljs-keyword">import</span> { dark, light } <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;daisyui/src/theming/themes&quot;</span>

<span class="hljs-keyword">const</span> <span class="hljs-title function_">applyTheme</span> = (<span class="hljs-params"><span class="hljs-attr">theme</span>: <span class="hljs-title class_">Theme</span></span>) =&gt; {
    <span class="hljs-variable language_">document</span>
      .<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;meta-theme-color&quot;</span>)
      ?.<span class="hljs-title function_">setAttribute</span>(
        <span class="hljs-string">&quot;content&quot;</span>,
        theme === <span class="hljs-string">&quot;dark&quot;</span> ? dark[<span class="hljs-string">&quot;base-100&quot;</span>] : light[<span class="hljs-string">&quot;base-100&quot;</span>]
      )
</code></pre>
<h2>Conclusion</h2>
<p>Were you expecting all these different concepts to come up just to implement dark mode? I know I wasn&#x27;t.
From the pre-rendered HTML generated by the server, to the render-blocking script interrupting the browser&#x27;s critical rendering path,
to the diffing of React Trees during Hydration, and the use of React Client Components to handle stateful interactions on the client using
Next.js&#x27;s App Router; there are quite a lot of layers involved.
Thankfully these concepts are useful to understand, which is why I think there&#x27;s a lot to learn from implementing a ‚Äúsimple‚Äù feature like this one and making it robust and polished.
There are third party libraries that handle dark mode for you,
but this is one of those cases where instead of working on a project where you try reinventing the wheel;
you can simply learn a lot by understanding how the wheel works.</p></article></div></div></div></div><script src="/_next/static/chunks/webpack-da7bd31efd1877ed.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"3:\"$Sreact.fragment\"\n4:I[4839,[\"839\",\"static/chunks/839-637add48329eea7f.js\",\"364\",\"static/chunks/app/blog/dark-mode-a-not-so-simple-story/page-b9d4e4c93075cca1.js\"],\"\"]\n5:I[3143,[\"839\",\"static/chunks/839-637add48329eea7f.js\",\"177\",\"static/chunks/app/layout-0a6be1a83533b9a5.js\"],\"ThemeSwitcher\"]\n6:I[5244,[],\"\"]\n7:I[3866,[],\"\"]\nc:I[6213,[],\"OutletBoundary\"]\ne:I[6213,[],\"MetadataBoundary\"]\n10:I[6213,[],\"ViewportBoundary\"]\n12:I[4835,[],\"\"]\n1:HL[\"/_next/static/media/a34f9d1faa5f3315-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n2:HL[\"/_next/static/css/0beb6f02e3b80d7a.css\",\"style\"]\n8:T592,\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { \u003cspan class=\"hljs-title class_\"\u003eMoon\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;lucide-react\u0026quot;\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eDarkModeButton\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eonClick\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e theme = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e,\n      theme === \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e\n    )\n  }\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eMoon\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{onClick}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\n}\n9:T789,\u003cspan class"])</script><script>self.__next_f.push([1,"=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useEffect } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseThemeHandler\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-title function_\"\u003euseEffect\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e theme = \u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, theme ?? \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e)\n  }, [])\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e theme = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e)\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newTheme = theme === \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, newTheme)\n\n    \u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e, newTheme)\n  }\n}\na:T850,"])</script><script>self.__next_f.push([1,";(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003einitTheme\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e storedTheme = \u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003etheme\u003c/span\u003e) =\u0026gt; {\n    \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, theme)\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (storedTheme) {\n    \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e(storedTheme)\n\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n  }\n\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e\n    .\u003cspan class=\"hljs-title function_\"\u003ematchMedia\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`(prefers-color-scheme: dark)`\u003c/span\u003e)\n    .\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;change\u0026quot;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003e{ matches }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n      }\n\n      \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e(matches ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e)\n    })\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e prefersDarkColorScheme = \u003cspan class=\"hljs-title function_\"\u003ematchMedia\u003c/span\u003e(\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;(prefers-color-scheme: dark)\u0026quot;\u003c/span\u003e\n  ).\u003cspan class=\"hljs-property\"\u003ematches\u003c/span\u003e\n\n  prefersDarkColorScheme \u0026amp;\u0026amp; \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e)\n})()\n"])</script><script>self.__next_f.push([1,"b:Tbaa,"])</script><script>self.__next_f.push([1,"\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { useCallback } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;react\u0026quot;\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eTheme\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e | \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003etheme\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTheme\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, theme)\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003egetStoredTheme\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; \u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003egetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003estoreTheme\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003cspan class=\"hljs-attr\"\u003etheme\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eTheme\u003c/span\u003e\u003c/span\u003e) =\u0026gt; \u003cspan class=\"hljs-variable language_\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003esetItem\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e, theme)\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseThemeHandler\u003c/span\u003e = (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003euseCallback\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e storedTheme = \u003cspan class=\"hljs-title function_\"\u003egetStoredTheme\u003c/span\u003e()\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (storedTheme) {\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newTheme = storedTheme === \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e\n\n      \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e(newTheme)\n\n      \u003cspan class=\"hljs-title function_\"\u003estoreTheme\u003c/span\u003e(newTheme)\n\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e\n    }\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e prefersDarkColorScheme = \u003cspan class=\"hljs-title function_\"\u003ematchMedia\u003c/span\u003e(\n      \u003cspan class=\"hljs-string\"\u003e\u0026quot;(prefers-color-scheme: dark)\u0026quot;\u003c/span\u003e\n    ).\u003cspan class=\"hljs-property\"\u003ematches\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e newTheme = prefersDarkColorScheme ? \u003cspan class=\"hljs-string\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e\n\n    \u003cspan class=\"hljs-title function_\"\u003eapplyTheme\u003c/span\u003e(newTheme)\n\n    \u003cspan class=\"hljs-title function_\"\u003estoreTheme\u003c/span\u003e(newTheme)\n  }, [])\n}\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"dWviglrGLUExZcNbGvMxL\",\"p\":\"\",\"c\":[\"\",\"blog\",\"dark-mode-a-not-so-simple-story\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"blog\",{\"children\":[\"dark-mode-a-not-so-simple-story\",{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$3\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0beb6f02e3b80d7a.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"data-theme\":\"light\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"meta\",null,{\"id\":\"meta-theme-color\",\"name\":\"theme-color\"}],[\"$\",\"link\",null,{\"id\":\"dark-css\",\"rel\":\"stylesheet\",\"href\":\"/dark.css\",\"suppressHydrationWarning\":true}],[\"$\",\"link\",null,{\"id\":\"light-css\",\"rel\":\"stylesheet\",\"href\":\"/light.css\",\"suppressHydrationWarning\":true}]]}],[\"$\",\"body\",null,{\"className\":\"__className_d65c78\",\"children\":[[\"$\",\"script\",null,{\"src\":\"/theme.js\"}],[\"$\",\"div\",null,{\"className\":\"flex justify-center px-4\",\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col h-dvh max-w-screen-lg w-full\",\"children\":[[\"$\",\"div\",null,{\"className\":\"navbar\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-1\",\"children\":[\"$\",\"$L4\",null,{\"className\":\"btn btn-ghost no-animation text-xl\",\"href\":\"/\",\"children\":\"Home\"}]}],[\"$\",\"div\",null,{\"className\":\"flex-none pr-2\",\"children\":[[\"$\",\"$L4\",null,{\"className\":\"btn btn-ghost no-animation text-xl\",\"href\":\"/about\",\"children\":\"About\"}],[\"$\",\"$L4\",null,{\"className\":\"btn btn-ghost no-animation text-xl\",\"href\":\"/blog\",\"children\":\"Blog\"}]]}],[\"$\",\"$L5\",null,{}]]}],[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":\"404\"}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],\"notFoundStyles\":[]}]]}]}]]}]]}]]}],{\"children\":[\"blog\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"dark-mode-a-not-so-simple-story\",[\"$\",\"$3\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"blog\",\"children\",\"dark-mode-a-not-so-simple-story\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"notFoundStyles\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$3\",\"c\",{\"children\":[[\"$\",\"div\",null,{\"className\":\"flex justify-center py-8\",\"children\":[\"$\",\"div\",null,{\"className\":\"max-w-screen-md w-full\",\"children\":[[\"$\",\"div\",null,{\"className\":\"pb-4\",\"children\":[\"$\",\"$L4\",null,{\"className\":\"flex items-center justify-center size-[48px] rounded-full btn-ghost\",\"href\":\"/blog\",\"children\":[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":32,\"height\":32,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-arrow-left\",\"children\":[[\"$\",\"path\",\"1l729n\",{\"d\":\"m12 19-7-7 7-7\"}],[\"$\",\"path\",\"x3x0zl\",{\"d\":\"M19 12H5\"}],\"$undefined\"]}]}]}],[\"$\",\"article\",null,{\"className\":\"prose prose-lg\",\"children\":[[\"$\",\"title\",null,{\"children\":\"Dark Mode, a Not so Simple Story ‚Ä¢ Alessio Palladino\"}],\"\\n\",[\"$\",\"h1\",null,{\"children\":\"Dark Mode, a Not so Simple Story\"}],\"\\n\",[\"$\",\"div\",null,{\"children\":[\"$\",\"small\",null,{\"children\":[\"$\",\"i\",null,{\"children\":\"Published November 11th, 2024\"}]}]}],\"\\n\",[\"$\",\"div\",null,{\"children\":[\"$\",\"small\",null,{\"children\":[\"$\",\"i\",null,{\"children\":\"Updated November 16th, 2024\"}]}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Introduction\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Dark mode may seem like an easy feature to implement. From the point of view of a user, you click a button and things change color.\\nHowever, appearances can be deceiving. If you stop and think of all the requirements for dark mode in detail, you'll soon realize that things are not so simple.\\nThere's also an interesting disconnect between implementing this feature in vanilla JS, and implementing it using a modern framework.\\nIn the latter, you'll run into cases where what you need to do is either unsupported or highly discouraged.\\nIn this article, I'll go into how I implemented dark mode for this website.\\nI think you'll be surprised by the myriad of concepts involved in implementing such a seemingly simple feature, I know I was!\\nThere's definitely a lot to be learned from doing something like this yourself!\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"The Requirements\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Let me begin by defining the requirements I had in mind when I wanted to implement dark mode:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Clicking the dark mode button changes the website color theme between ‚Äúlight‚Äù and ‚Äúdark‚Äù.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"When the dark mode button is clicked, the applied theme is persisted. This way if the user reloads the page,\\nthe chosen theme remains active (the user does not have to click the button again).\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"If the user reloads the page there should not be any kind of flickering between themes.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"If the user has not interacted with the dark mode button, the user's system theme is used as default.\\nAnd if the system theme changes, the website theme changes accordingly.\\nOnce the user interacts with the dark mode button, the system theme is not taken into account anymore.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"My Tech Stack\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Dark mode can be implemented in vanilla JS. However, the interesting bit is making it work the same way using a modern framework.\\nI implemented this website using \",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/\",\"children\":\"Next.js\"}],\" and its \",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app\",\"children\":\"App Router\"}],\".\\nI use \",[\"$\",\"a\",null,{\"href\":\"https://tailwindcss.com/\",\"children\":\"Tailwind CSS\"}],\" and \",[\"$\",\"a\",null,{\"href\":\"https://daisyui.com/\",\"children\":\"Daisy UI\"}],\" to handle styling my website.\\nIn particular, Daisy UI lets me easily apply default themes to the entire website.\"]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Implementing Dark Mode\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"1. Handling Themes With Daisy UI\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí°\",[\"$\",\"strong\",null,{\"children\":\"Key concept:\"}],\" using a \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/data-*\",\"children\":[\"$\",\"code\",null,{\"children\":\"data-*\"}]}],\"\\nattribute to set a theme for the website.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If you're curious about following my implementation and you're using another library to handle your design system, Daisy UI isn't necessary.\\nHowever, it does provide preconfigured themes and makes it really easy to apply any one of them to the entire website.\\nIn your tailwind config file you just need to specify:\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-attr\\\"\u003edaisyui\u003c/span\u003e: {\\n  \u003cspan class=\\\"hljs-attr\\\"\u003ethemes\u003c/span\u003e: [\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e],\\n},\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"After that all you need to do is set the \",[\"$\",\"code\",null,{\"children\":\"data-theme\"}],\" attribute on an element high up in the DOM with either the ‚Äúlight‚Äù or ‚Äúdark‚Äù value.\\nI use ‚Äúlight‚Äù as the default fallback:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-html hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;\u003cspan class=\\\"hljs-name\\\"\u003ehtml\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003edata-theme\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;/\u003cspan class=\\\"hljs-name\\\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Do this in the Next.js \",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/app/building-your-application/routing/layouts-and-templates#root-layout-required\",\"children\":\"Root Layout\"}],\"\\nto modify the initial HTML returned from the server for every page.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"And you're done! This is all you need to apply a theme to your website. The real trick will be correctly switching between themes.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Note: whether you're using Daisy UI or not, you should have a way to switch between themes by simply specifying a value for a \",[\"$\",\"code\",null,{\"children\":\"data-*\"}],\" attribute.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"2. Switching Between Themes With a Button\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí°\",[\"$\",\"strong\",null,{\"children\":\"Key concept:\"}],\" React Server Components vs. React Client Components.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now that we have a way to easily apply different themes to our website, let's fulfill the first requirement I listed before: adding a button that allows the user to swap between themes.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"As I mentioned earlier, when the user clicks on the button we want to change the \",[\"$\",\"code\",null,{\"children\":\"data-*\"}],\" theme attribute on the \",[\"$\",\"code\",null,{\"children\":\"\u003chtml\u003e\"}],\" element. You might think of implementing a Component like this one:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-tsx hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"$8\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Note: I'm currently using \",[\"$\",\"code\",null,{\"children\":\"lucide-react\"}],\" for my icons. If you want the icon itself to\\nchange color according to the current theme, you can specify a CSS class for the icon and then\\nset different colors for it according to the theme in your tailwind config file.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"However, if you're using the App Router you'll run into a runtime error right away:\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-text hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"Error: Event handlers cannot be passed to Client Component props.\\n  \u0026lt;button onClick={function onClick} children=...\u0026gt;\\n                  ^^^^^^^^^^^^^^^^^^\\nIf you need interactivity, consider converting part of this to a Client Component.\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When using the App Router every Component is a React Server Component (RSC) by default, unless specified otherwise with the \",[\"$\",\"code\",null,{\"children\":\"'use client'\"}],\" directive.\\nI won't explain React Server Components in detail in this article,\\nbut Josh Comeau wrote a great article, \",[\"$\",\"a\",null,{\"href\":\"https://www.joshwcomeau.com/react/server-components/\",\"children\":\"Making Sense of React Server Components\"}],\",\\nwhich explains them very clearly. To make a long story short, React Server Components do not allow for interactivity.\\nThough they are new and may initially frustrate you with errors like the one above,\\nReact Server Components are actually simpler versions of ‚Äúregular‚Äù Components.\\nYou can't use any \",[\"$\",\"code\",null,{\"children\":\"useState\"}],\" or \",[\"$\",\"code\",null,{\"children\":\"useEffect\"}],\" hooks in them. And seeing as they only render \",[\"$\",\"strong\",null,{\"children\":\"once\"}],\",\\nthey free you from some of the \",[\"$\",\"a\",null,{\"href\":\"https://react.dev/reference/rules\",\"children\":\"Rules of React\"}],\" since you'll never run into any re-render related issues with them.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our case we need interactivity and therefore can't use a React Server Component for our button. We need ‚Äúregular‚Äù React Components, now known as Client Components.\\nSimply adding the \",[\"$\",\"code\",null,{\"children\":\"'use client'\"}],\" directive at the top of the file above fixes the issue for us.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now we can change the theme with a click of a button, but if you reload the page you'll see that the changes to the theme are lost‚Ä¶\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"3. Persisting the Theme Using Local Storage\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí°\",[\"$\",\"strong\",null,{\"children\":\"Key concept:\"}],\" local storage.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In order to avoid losing changes to the theme, we must persist the theme in some way.\\nUsing the \",[\"$\",\"code\",null,{\"children\":\"window\"}],\" \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage\",\"children\":\"localStorage\"}],\" property makes this a breeze.\\nWhen the user clicks on the button, we store the name of the applied theme. And when the page loads,\\nwe read from local storage and set the theme accordingly. Though as you'll see we'll quickly run into an important issue later on.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Let's create a hook called \",[\"$\",\"code\",null,{\"children\":\"useThemeHandler()\"}],\" to encapsulate all of our\\ntheme switching logic, which we can then call in our \",[\"$\",\"code\",null,{\"children\":\"DarkModeButton\"}],\" Component.\\nThe hook will:\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Call \",[\"$\",\"code\",null,{\"children\":\"useEffect()\"}],\" to handle reading from local storage and\\napply the current theme on page load.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Return a callback that handles switching and storing the theme,\\nwhich we can pass to the \",[\"$\",\"code\",null,{\"children\":\"onClick\"}],\" attribute of our \",[\"$\",\"code\",null,{\"children\":\"\u003cbutton\u003e\"}],\".\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-tsx hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"$9\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Then our \",[\"$\",\"code\",null,{\"children\":\"DarkModeButton\"}],\" will just be:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-tsx hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;use client\u0026quot;\u003c/span\u003e\\n\\n\u003cspan class=\\\"hljs-keyword\\\"\u003eimport\u003c/span\u003e { \u003cspan class=\\\"hljs-title class_\\\"\u003eMoon\u003c/span\u003e } \u003cspan class=\\\"hljs-keyword\\\"\u003efrom\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;lucide-react\u0026quot;\u003c/span\u003e\\n\u003cspan class=\\\"hljs-keyword\\\"\u003eimport\u003c/span\u003e { useThemeHandler } \u003cspan class=\\\"hljs-keyword\\\"\u003efrom\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;./useThemeHandler\u0026quot;\u003c/span\u003e\\n\\n\u003cspan class=\\\"hljs-keyword\\\"\u003eexport\u003c/span\u003e \u003cspan class=\\\"hljs-keyword\\\"\u003econst\u003c/span\u003e \u003cspan class=\\\"hljs-title function_\\\"\u003eDarkModeButton\u003c/span\u003e = (\u003cspan class=\\\"hljs-params\\\"\u003e\u003c/span\u003e) =\u0026gt; {\\n  \u003cspan class=\\\"hljs-keyword\\\"\u003econst\u003c/span\u003e handleTheme = \u003cspan class=\\\"hljs-title function_\\\"\u003euseThemeHandler\u003c/span\u003e()\\n\\n  \u003cspan class=\\\"hljs-keyword\\\"\u003ereturn\u003c/span\u003e \u003cspan class=\\\"language-xml\\\"\u003e\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;\u003cspan class=\\\"hljs-name\\\"\u003eMoon\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003eonClick\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e{handleTheme}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e\\n}\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The theme is now persisted if we reload the page.\\nHowever, when we reload it we can clearly see that the theme flickers... üò±\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/themeflicker.gif\",\"alt\":\"Theme flicker\",\"title\":\"Theme flicker\"}]}]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"4. Preventing Theme Flicker\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí°\",[\"$\",\"strong\",null,{\"children\":\"Key concept:\"}],\" the critical rendering path.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now onto my favorite part.\\nPreventing the theme from flickering will force us to implement a solution\\nthat goes against the recommendations of an opinionated framework like Next.js.\\nI find this topic particularly stimulating because while a framework can be opinionated for good reasons,\\nit's always interesting to see cases where we need to exit the framework and venture into what seems like no man's land.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our case, to prevent the theme from flickering,\\nwe'll need to block the rendering of the page until we've determined what theme to use.\\nMore specifically, during the first of five steps in the\\n\",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/Performance/Critical_rendering_path\",\"children\":\"critical rendering path\"}],\",\\nthe browser processes the HTML and builds the DOM.\\nAccording to the MDN web docs\\n\",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/Performance/How_browsers_work#parsing\",\"children\":\"Populating the page: how browsers work\"}],\":\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When the parser finds non-blocking resources, such as an image, the browser will request those resources and continue parsing. Parsing can continue when a CSS file is encountered, but \",[\"$\",\"code\",null,{\"children\":\"\u003cscript\u003e\"}],\" elements ‚Äî particularly those without an async or defer attribute ‚Äî block rendering, and pause the parsing of HTML. Though the browser's preload scanner hastens this process, excessive scripts can still be a significant bottleneck.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can start to see why Next.js discourages what we're about to do‚Ä¶\\nTo block rendering until we've established what theme to use, we'll write a script to determine the theme to use and insert it at the very top of the \",[\"$\",\"code\",null,{\"children\":\"\u003cbody\u003e\"}],\" element in our Root Layout.\\nThis is not possible using the Next.js \",[\"$\",\"code\",null,{\"children\":\"\u003cScript\u003e\"}],\" Component. We'll also have to disable the \",[\"$\",\"code\",null,{\"children\":\"@next/next/no-sync-scripts\"}],\" ESLint rule:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-html hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;\u003cspan class=\\\"hljs-name\\\"\u003ebody\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003eclassName\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;{inter.className}\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\\n  {/* eslint-disable-next-line @next/next/no-sync-scripts */}\\n  \u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;\u003cspan class=\\\"hljs-name\\\"\u003escript\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003esrc\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;/theme.js\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003cspan class=\\\"language-handlebars\\\"\u003e\u003cspan class=\\\"language-xml\\\"\u003e\\n\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;/\u003cspan class=\\\"hljs-name\\\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\\n\u003c/span\u003e\u003c/span\u003e\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The script itself is very simple and does the same thing we were doing in the \",[\"$\",\"code\",null,{\"children\":\"useThemeHandler\"}],\" hook's \",[\"$\",\"code\",null,{\"children\":\"useEffect\"}],\":\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\";(\u003cspan class=\\\"hljs-keyword\\\"\u003efunction\u003c/span\u003e \u003cspan class=\\\"hljs-title function_\\\"\u003einitTheme\u003c/span\u003e(\u003cspan class=\\\"hljs-params\\\"\u003e\u003c/span\u003e) {\\n  \u003cspan class=\\\"hljs-keyword\\\"\u003econst\u003c/span\u003e theme = \u003cspan class=\\\"hljs-variable language_\\\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\\\"hljs-title function_\\\"\u003egetItem\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)\\n\\n  \u003cspan class=\\\"hljs-variable language_\\\"\u003edocument\u003c/span\u003e.\u003cspan class=\\\"hljs-property\\\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\\\"hljs-title function_\\\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, theme ?? \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e)\\n})()\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We're wrapping the script in an \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Glossary/IIFE\",\"children\":\"IIFE\"}],\" in order for it to execute immediately.\\nAnd now, no more flickering! ü•≥\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Note: with the current implementation, if you open your DevTools you'll see an interesting error.\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-text hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"Warning: Prop `data-theme` did not match. Server: \u0026quot;dark\u0026quot; Client: \u0026quot;light\u0026quot;\\nat html\\nat RootLayout (Server)\\nat RedirectErrorBoundary (\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Next.js pre-renders our application's React tree on the server so that our browser may receive pre-rendered HTML.\\nAs is stated in the documentation for the\\n\",[\"$\",\"a\",null,{\"href\":\"https://nextjs.org/docs/messages/react-hydration-error\",\"children\":\"Text content does not match server-rendered HTML\"}],\" error:\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Hydration is when React converts the pre-rendered HTML from the server into a fully interactive application by attaching event handlers.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When there is a difference between the React tree pre-rendered on the server and the React tree following Hydration, Next.js shows us this error.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In our case this makes sense because in our Root Layout, which defines initial HTML returned from the server for every page,\\nwe specified ‚Äúlight‚Äù as the default value for the html elements's \",[\"$\",\"code\",null,{\"children\":\"data-theme\"}],\" attribute. But when the user chooses dark mode and our render-blocking script runs,\\nthat attribute changes, causing a difference in the React trees.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Fortunately we can easily silence this error by adding the \",[\"$\",\"code\",null,{\"children\":\"suppressHydrationWarning\"}],\" attribute to our html element.\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"5. Respecting the User's System Theme Preference\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"üí°\",[\"$\",\"strong\",null,{\"children\":\"Key concept:\"}],\" the Window interface's \",[\"$\",\"code\",null,{\"children\":\"matchMedia()\"}],\" method.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We basically completed dark mode, but one improvement could be to set the initial theme according to the user's system preference.\\nSo in case the user hasn't interacted with the dark mode button, therefore not communicated a preference between the light or dark themes;\\nwe can begin by setting the theme to match the user's system theme instead of always defaulting to ‚Äúlight‚Äù.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We'll use the \",[\"$\",\"code\",null,{\"children\":\"prefers-color-scheme: dark\"}],\" media query to detect if the user requested light or dark color themes.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Thankfully this is easy to do in JavaScript using the Window interface's \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Window/matchMedia\",\"children\":\"matchMedia()\"}],\" method.\\nIn our render-blocking script, if there is no stored theme, we can set it to dark mode if the user requested it:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-keyword\\\"\u003econst\u003c/span\u003e prefersDarkColorScheme = \u003cspan class=\\\"hljs-title function_\\\"\u003ematchMedia\u003c/span\u003e(\\n  \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;(prefers-color-scheme: dark)\u0026quot;\u003c/span\u003e\\n).\u003cspan class=\\\"hljs-property\\\"\u003ematches\u003c/span\u003e\\n\\n\u003cspan class=\\\"hljs-keyword\\\"\u003eif\u003c/span\u003e (prefersDarkColorScheme) {\\n  \u003cspan class=\\\"hljs-variable language_\\\"\u003edocument\u003c/span\u003e.\u003cspan class=\\\"hljs-property\\\"\u003edocumentElement\u003c/span\u003e.\u003cspan class=\\\"hljs-title function_\\\"\u003esetAttribute\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;data-theme\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e)\\n}\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For additional polish, we can add an event listener to the media query list returned by the \",[\"$\",\"code\",null,{\"children\":\"matchMedia()\"}],\" method:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-variable language_\\\"\u003ewindow\u003c/span\u003e\\n  .\u003cspan class=\\\"hljs-title function_\\\"\u003ematchMedia\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e`(prefers-color-scheme: dark)`\u003c/span\u003e)\\n  .\u003cspan class=\\\"hljs-title function_\\\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;change\u0026quot;\u003c/span\u003e, \u003cspan class=\\\"hljs-function\\\"\u003e(\u003cspan class=\\\"hljs-params\\\"\u003e{ matches }\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\\n    \u003cspan class=\\\"hljs-keyword\\\"\u003eif\u003c/span\u003e (\u003cspan class=\\\"hljs-variable language_\\\"\u003elocalStorage\u003c/span\u003e.\u003cspan class=\\\"hljs-title function_\\\"\u003egetItem\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;theme\u0026quot;\u003c/span\u003e)) {\\n      \u003cspan class=\\\"hljs-keyword\\\"\u003ereturn\u003c/span\u003e\\n    }\\n\\n    \u003cspan class=\\\"hljs-title function_\\\"\u003eapplyTheme\u003c/span\u003e(matches ? \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e : \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;light\u0026quot;\u003c/span\u003e)\\n  })\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This way if the user still hasn't interacted with the dark mode button but changes the system theme while our website is open,\\nthe website's color scheme will change when the system theme also changes.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"flex justify-center\",\"children\":[\"$\",\"p\",null,{\"children\":[\"$\",\"img\",null,{\"src\":\"/images/matchmediainaction.gif\",\"alt\":\"Match media in action\",\"title\":\"Match media in\\naction\"}]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"My final render-blocking script looks something like this:\"}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-js hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"$a\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"While my \",[\"$\",\"code\",null,{\"children\":\"useThemeHandler()\"}],\" looks like this:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"$b\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Note that the last lines of the hook handle the case where the user clicks on the button but the new theme to apply may not be the default light color scheme\\nsince we are now reacting to the \",[\"$\",\"code\",null,{\"children\":\"prefers-color-scheme: dark\"}],\" in our render-blocking script.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"And that's it, we now have a robust and polished dark mode feature on our website! üéâ\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To keep things relatively simple, I left out some logic from the above script and hook.\\nBut below I'll discuss how you can handle that yourself if you feel so inclined. üôÇ\"}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"6. Bonus Points\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Without going too much into detail I wanted to mention two additional cases\\nyou might want to be aware of if you're implementing dark mode yourself.\"}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Supporting Syntax Highlighting\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In case you haven't noticed yet, when you switch the theme on my website\\nthe syntax highlighting for the code blocks changes.\\nThis is simple enough to do, you just need to include the stylesheets for each theme\\nin your Root Layout.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"What you may not know is that you can disable any one of the stylesheets programmatically\\nwith the \",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLLinkElement/disabled\",\"children\":\"HTMLLinkElement: disabled property\"}],\":\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Setting the disabled property using JavaScript causes the stylesheet to be removed from the document's Document.styleSheets list.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"h3\",null,{\"children\":\"Setting the User Agent UI Color Scheme\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This is an edge case that I noticed is not even handled in\\n\",[\"$\",\"a\",null,{\"href\":\"https://github.com/saadeghi/theme-change\",\"children\":\"theme-change\"}],\"\\n, which Daisy UI recommends in its documentation for handling switching themes.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Some browsers allow theme colors to be set on the user interface surrounding the page.\\nWhen switching themes programmatically like we are, this theme color is not updated the same way.\\nWhat results is a visible bug where our website displays the correctly selected theme while the\\nsurrounding UI is still displaying the previous color scheme. Refreshing the page correctly updates the\\nUI, but that's not good enough for us!\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Below you can see an example of what I mean. In the first screenshot you see the correct light color scheme.\\nHowever when I click on the dark mode button the website theme correctly changes but the\\nsurrounding browser UI (visibly the status and address bar areas) is still using\\nthe \\\"light\\\" color scheme. In the last screenshot I reloaded the page and the dark theme is\\ncorrectly displayed.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"flex gap-2\",\"children\":[[\"$\",\"img\",null,{\"width\":\"33%\",\"src\":\"/images/lighttheme.PNG\",\"alt\":\"Homepage with light theme\"}],[\"$\",\"img\",null,{\"width\":\"33%\",\"src\":\"/images/themeupdatebug.PNG\",\"alt\":\"Homepage with bug where both light and dark themes are visible\"}],[\"$\",\"img\",null,{\"width\":\"33%\",\"src\":\"/images/darktheme.PNG\",\"alt\":\"Homepage with dark theme\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can fix this by specifying a \",[\"$\",\"code\",null,{\"children\":\"\u003cmeta\u003e\"}],\" element with\\n\",[\"$\",\"code\",null,{\"children\":\"name=\\\"theme-color\\\"\"}],\" and some \",[\"$\",\"code\",null,{\"children\":\"id\"}],\". Then programmatically set the \",[\"$\",\"code\",null,{\"children\":\"content\"}],\" attribute with\\nthe desired color when switching themes. As stated in the documentation,\\n\",[\"$\",\"a\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta/name/theme-color\",\"children\":\"theme-color\"}],\":\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"indicates a suggested color that user agents should use to customize the display of the page or of the surrounding user interface.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In my Root Layout I included this \",[\"$\",\"code\",null,{\"children\":\"\u003cmeta\u003e\"}],\" element in the document \",[\"$\",\"code\",null,{\"children\":\"\u003chead\u003e\"}],\":\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-html hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-tag\\\"\u003e\u0026lt;\u003cspan class=\\\"hljs-name\\\"\u003emeta\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003eid\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;meta-theme-color\u0026quot;\u003c/span\u003e \u003cspan class=\\\"hljs-attr\\\"\u003ename\u003c/span\u003e=\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;theme-color\u0026quot;\u003c/span\u003e /\u0026gt;\u003c/span\u003e\\n\"}}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Then in the \",[\"$\",\"code\",null,{\"children\":\"useThemeHandler()\"}],\" hook, when applying a \",[\"$\",\"code\",null,{\"children\":\"theme\"}],\", I do this:\"]}],\"\\n\",[\"$\",\"pre\",null,{\"className\":\"break-words code-block text-wrap\",\"children\":[\"$\",\"code\",null,{\"className\":\"language-ts hljs\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cspan class=\\\"hljs-keyword\\\"\u003eimport\u003c/span\u003e { dark, light } \u003cspan class=\\\"hljs-keyword\\\"\u003efrom\u003c/span\u003e \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;daisyui/src/theming/themes\u0026quot;\u003c/span\u003e\\n\\n\u003cspan class=\\\"hljs-keyword\\\"\u003econst\u003c/span\u003e \u003cspan class=\\\"hljs-title function_\\\"\u003eapplyTheme\u003c/span\u003e = (\u003cspan class=\\\"hljs-params\\\"\u003e\u003cspan class=\\\"hljs-attr\\\"\u003etheme\u003c/span\u003e: \u003cspan class=\\\"hljs-title class_\\\"\u003eTheme\u003c/span\u003e\u003c/span\u003e) =\u0026gt; {\\n    \u003cspan class=\\\"hljs-variable language_\\\"\u003edocument\u003c/span\u003e\\n      .\u003cspan class=\\\"hljs-title function_\\\"\u003egetElementById\u003c/span\u003e(\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;meta-theme-color\u0026quot;\u003c/span\u003e)\\n      ?.\u003cspan class=\\\"hljs-title function_\\\"\u003esetAttribute\u003c/span\u003e(\\n        \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;content\u0026quot;\u003c/span\u003e,\\n        theme === \u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;dark\u0026quot;\u003c/span\u003e ? dark[\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;base-100\u0026quot;\u003c/span\u003e] : light[\u003cspan class=\\\"hljs-string\\\"\u003e\u0026quot;base-100\u0026quot;\u003c/span\u003e]\\n      )\\n\"}}]}],\"\\n\",[\"$\",\"h2\",null,{\"children\":\"Conclusion\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Were you expecting all these different concepts to come up just to implement dark mode? I know I wasn't.\\nFrom the pre-rendered HTML generated by the server, to the render-blocking script interrupting the browser's critical rendering path,\\nto the diffing of React Trees during Hydration, and the use of React Client Components to handle stateful interactions on the client using\\nNext.js's App Router; there are quite a lot of layers involved.\\nThankfully these concepts are useful to understand, which is why I think there's a lot to learn from implementing a ‚Äúsimple‚Äù feature like this one and making it robust and polished.\\nThere are third party libraries that handle dark mode for you,\\nbut this is one of those cases where instead of working on a project where you try reinventing the wheel;\\nyou can simply learn a lot by understanding how the wheel works.\"}]]}]]}]}],null,[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}]]}],{},null]},null]},null]},null],[\"$\",\"$3\",\"h\",{\"children\":[null,[\"$\",\"$3\",\"PDT7EbTHcww3qWNu7kiZg\",{\"children\":[[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}],[\"$\",\"$L10\",null,{\"children\":\"$L11\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\"}]]}]]}]]],\"m\":\"$undefined\",\"G\":[\"$12\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"11:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nf:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"link\",\"1\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"32x32\"}]]\n"])</script><script>self.__next_f.push([1,"d:null\n"])</script></body></html>